# Secrets

> Reminder: dotenv-never-lies is not a secrets manager.

This page explains what the notion of **secret** means in dotenv-never-lies,  
what this flag actually does, and — just as importantly — what it does **not** do.

**What a secret means in dotenv-never-lies**

In dotenv-never-lies, a secret is **not inferred from a value** and **not detected at runtime**.

A secret is a **semantic attribute of the schema**, explicitly declared by the developer.
Marking a variable as secret does not encrypt it, hide it in memory, or prevent access at runtime.

The goal is not protection, but **intentional handling**.

In short:  
a secret is not protected — it is **identified**.

## Declaration in the DNL schema

... as said in main readme

## Secret and Inference (heuristics)

When generating a schema using dnl infer, dotenv-never-lies may suggest that a variable looks like a secret.

This detection is based on heuristics (variable names such as SECRET, TOKEN, KEY, PASSWORD, etc.).
It is **never authoritative** and exists only to help with migration.

When a variable is flagged as a potential secret during inference, a clear warning is emitted in the generated schema.
This warning is meant to force a manual review.

Inference can be made fully neutral using:

```bash
dnl infer --dont-guess-secret
```

In that case, all generated variables are emitted with secret: undefined.

A schema generated by inference is always a starting point, never a finished contract.

## Secrets and validation

Marking a variable as secret has **no impact on validation**.
nor in `dnl assert` nor in `dnl.assert();`

A secret is validated exactly like any other variable.
They are first-class configuration values — simply annotated.

## Secrets and CLI commands

**assert**: validates secrets like any other variable. There is no special handling, masking, or exclusion.

**infer**: dnl infer may guess potential secrets using heuristics.
This detection is optional, fallible, and always requires human review.

**export**: adapts its behavior depending on the target format and flags.
When `--hide-secret` is set (and applyable), variable is serialised and secret is replaced by a '\*\*\*\*\*\*' string
When `--exclude-secret` is set (and applyable), variable is not serialized at all.

### During export

Variables marked `secret: true` in the schema are treated differently depending on the export format.

| Format        | Secrets included by default | Maskable (`--hide-secret`) | Excludable (`--exclude-secret`) | Notes                      |
| ------------- | --------------------------- | -------------------------- | ------------------------------- | -------------------------- |
| env           | yes                         | yes                        | yes                             | classic .env               |
| docker-env    | yes                         | yes                        | yes                             | For --env-file             |
| docker-args   | yes                         | yes                        | yes                             | For docker run -e          |
| json          | yes                         | yes                        | yes                             | Debug / tooling            |
| ts            | yes                         | yes                        | yes                             | Typed export               |
| js            | yes                         | yes                        | yes                             | Runtime export             |
| github-env    | yes                         | yes                        | yes                             | visible in logs            |
| github-secret | secrets only                | no                         | yes                             | Via gh secret set          |
| gitlab-env    | yes                         | yes                        | yes                             | GitLab CI variables        |
| k8s-configmap | yes                         | yes                        | yes                             | warning if secret unmasked |
| k8s-secret    | secrets only                | yes                        | yes                             | Kubernetes Secret          |

## Design note

Whether a variable is secret is contextual, not technical.
A URL, a number, or a boolean may be secret depending on how it is used.

Failing to mark a real secret is more dangerous than marking a non-secret by mistake.
For this reason, dotenv-never-lies deliberately favors false positives over false negatives.

dotenv-never-lies does not manage secrets.
It helps you not forget where they are.
